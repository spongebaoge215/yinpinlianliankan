<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>音频设备连连看</title>
    <script src="https://cdn.tailwindcss.com/3.3.3"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
            color: #1e293b;
        }
        
        .device-label {
            width: 100px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: grab;
            transition: all 0.2s ease;
            font-weight: bold;
            font-size: 14px;
            color: #1e293b;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            text-align: center;
        }
        
        .device-label:active {
            cursor: grabbing;
        }
        
        .drop-zone {
            width: 80px;
            height: 80px;
            border: 2px dashed #cbd5e1;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            border-radius: 8px;
            background-color: white;
        }
        
        .drop-zone.highlight {
            border-color: #94a3b8;
            background-color: #f1f5f9;
        }
        
        .drop-zone:hover {
            background-color: #f1f5f9;
        }
        
        .drop-zone-content {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
            text-align: center;
        }
        
        .correct {
            border-color: #10b981 !important;
            background-color: #ecfdf5;
        }
        
        .wrong {
            border-color: #ef4444 !important;
            background-color: #fef2f2;
        }
        
        .score-animation {
            animation: pulse 0.5s ease-in-out;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        .valid-sequence {
            position: relative;
        }
        
        .valid-sequence:hover::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(241, 245, 249, 0.7);
            z-index: -1;
        }
        
        .score-title {
            font-size: 14px;
        }
        
        .score-value {
            font-size: 12px;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center py-8 px-4">
    <h1 class="text-3xl font-bold mb-8">音频设备连连看</h1>
    
    <!-- 设备选择区域 -->
    <div class="mb-12 w-full max-w-4xl">
        <h2 class="text-xl font-semibold mb-4 text-center">选择设备</h2>
        <div class="flex justify-around bg-white p-6 rounded-lg shadow-sm gap-4">
            <div class="device-label" draggable="true" data-device="3" id="monitor-controller">监听控制器</div>
            <div class="device-label" draggable="true" data-device="4" id="audio-interface">音频接口</div>
            <div class="device-label" draggable="true" data-device="2" id="preamp">话放</div>
            <div class="device-label" draggable="true" data-device="5" id="speaker">音箱</div>
            <div class="device-label" draggable="true" data-device="1" id="mic">话筒</div>
        </div>
    </div>
    
    <!-- 排列区域 -->
    <div class="mb-12 w-full max-w-4xl">
        <h2 class="text-xl font-semibold mb-4 text-center">连接顺序</h2>
        <div class="flex justify-around bg-white p-6 rounded-lg shadow-sm gap-2">
            <div class="drop-zone valid-sequence" data-position="1"></div>
            <div class="drop-zone valid-sequence" data-position="2"></div>
            <div class="drop-zone valid-sequence" data-position="3"></div>
            <div class="drop-zone valid-sequence" data-position="4"></div>
            <div class="drop-zone valid-sequence" data-position="5"></div>
            <div class="drop-zone valid-sequence" data-position="6"></div>
            <div class="drop-zone valid-sequence" data-position="7"></div>
            <div class="drop-zone valid-sequence" data-position="8"></div>
            <div class="drop-zone valid-sequence" data-position="9"></div>
            <div class="drop-zone valid-sequence" data-position="10"></div>
        </div>
    </div>
    
    <!-- 排行榜区域 -->
    <div class="w-full max-w-md bg-white p-6 rounded-lg shadow-sm">
        <h2 class="text-xl font-semibold mb-4 text-center score-title">得分</h2>
        <div class="grid grid-cols-2 gap-4">
            <div class="bg-slate-50 p-4 rounded">
                <p class="text-sm text-slate-500 mb-1 score-title">当前得分</p>
                <p class="text-2xl font-bold score-value" id="current-score">0</p>
            </div>
            <div class="bg-slate-50 p-4 rounded">
                <p class="text-sm text-slate-500 mb-1 score-title">历史最高</p>
                <p class="text-2xl font-bold score-value" id="high-score">0</p>
            </div>
        </div>
        <button id="check-btn" class="w-full mt-4 bg-slate-800 text-white py-2 px-4 rounded hover:bg-slate-700 transition-colors">
            检查连接
        </button>
    </div>
    
    <footer class="mt-12 text-sm text-slate-500 text-center">
        <p>created by <a href="https://space.coze.cn" class="text-slate-700 hover:underline">coze space</a></p>
        <p>页面内容均由 AI 生成，仅供参考</p>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // 从localStorage加载最高分
            const highScore = localStorage.getItem('audioLinkHighScore') || 0;
            document.getElementById('high-score').textContent = highScore;
            
            // 拖拽相关变量
            let draggedItem = null;
            const dropZones = document.querySelectorAll('.drop-zone');
            const deviceLabels = document.querySelectorAll('.device-label');
            const checkBtn = document.getElementById('check-btn');
            const currentScoreEl = document.getElementById('current-score');
            
            // 为设备标签添加拖拽事件
            deviceLabels.forEach(label => {
                label.addEventListener('dragstart', function(e) {
                    draggedItem = this;
                    e.dataTransfer.setData('text/plain', this.dataset.device);
                    setTimeout(() => {
                        this.style.opacity = '0.4';
                    }, 0);
                });
                
                label.addEventListener('dragend', function() {
                    this.style.opacity = '1';
                });
            });
            
            // 为放置区域添加拖拽事件
            dropZones.forEach(zone => {
                zone.addEventListener('dragenter', function(e) {
                    e.preventDefault();
                    this.classList.add('highlight');
                });
                
                zone.addEventListener('dragover', function(e) {
                    e.preventDefault();
                });
                
                zone.addEventListener('dragleave', function() {
                    this.classList.remove('highlight');
                });
                
                zone.addEventListener('drop', function(e) {
                    e.preventDefault();
                    this.classList.remove('highlight');
                    
                    const deviceType = e.dataTransfer.getData('text/plain');
                    const deviceText = document.getElementById(getDeviceId(deviceType)).textContent;
                    
                    // 清空当前区域
                    while (this.firstChild) {
                        this.removeChild(this.firstChild);
                    }
                    
                    // 添加设备文字标签
                    const content = document.createElement('div');
                    content.className = 'drop-zone-content';
                    content.textContent = deviceText;
                    
                    this.appendChild(content);
                    this.dataset.filled = deviceType;
                });
            });
            
            // 检查按钮点击事件
            checkBtn.addEventListener('click', function() {
                const zones = Array.from(dropZones);
                let bestSequence = null;
                let bestScore = 0;
                
                // 检查所有可能的5个连续框体组合
                for (let i = 0; i <= 5; i++) {
                    const sequence = zones.slice(i, i + 5);
                    const score = evaluateSequence(sequence);
                    
                    if (score > bestScore) {
                        bestScore = score;
                        bestSequence = sequence;
                    }
                }
                
                // 重置所有框体样式
                dropZones.forEach(zone => {
                    zone.classList.remove('correct', 'wrong');
                });
                
                // 计算得分
                const totalScore = Math.round((bestScore / 5) * 100);
                currentScoreEl.textContent = totalScore;
                currentScoreEl.classList.add('score-animation');
                
                // 更新最高分
                if (totalScore > highScore) {
                    document.getElementById('high-score').textContent = totalScore;
                    localStorage.setItem('audioLinkHighScore', totalScore);
                }
                
                // 标记正确和错误的框体
                if (bestScore > 0) {
                    // 标记正确的序列
                    bestSequence.forEach((zone, index) => {
                        if (index < bestScore) {
                            zone.classList.add('correct');
                        } else {
                            zone.classList.add('wrong');
                        }
                    });
                    
                    // 标记序列后的所有框体为错误
                    const startIndex = Array.from(dropZones).indexOf(bestSequence[0]);
                    for (let i = startIndex + bestScore; i < dropZones.length; i++) {
                        dropZones[i].classList.add('wrong');
                    }
                } else {
                    // 没有找到有效序列，标记所有放置了设备的框体为错误
                    dropZones.forEach(zone => {
                        if (zone.dataset.filled) {
                            zone.classList.add('wrong');
                        }
                    });
                }
                
                // 移除动画类
                setTimeout(() => {
                    currentScoreEl.classList.remove('score-animation');
                }, 500);
            });
            
            // 评估序列是否符合正确顺序
            function evaluateSequence(sequence) {
                const expectedOrder = ['1', '2', '4', '3', '5']; // 话筒→话放→音频接口→监听控制器→音箱
                let score = 0;
                
                for (let i = 0; i < sequence.length; i++) {
                    if (sequence[i].dataset.filled === expectedOrder[i]) {
                        score++;
                    } else {
                        break;
                    }
                }
                
                return score;
            }
            
            // 根据设备类型获取元素ID
            function getDeviceId(deviceType) {
                switch(deviceType) {
                    case '1': return 'mic';
                    case '2': return 'preamp';
                    case '3': return 'monitor-controller';
                    case '4': return 'audio-interface';
                    case '5': return 'speaker';
                    default: return '';
                }
            }
        });
    </script>
</body>
</html>